<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Temp Mail</title>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background: linear-gradient(to bottom right, #e0f7fa, #e3f2fd); color:#1e1e1e; }
    header { padding:20px; text-align:center; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
    .email-box { background:#fff; margin:20px; padding:20px; border:1px dashed #ccc; border-radius:10px; text-align:center; }
    .email-address { background:#eef1f5; padding:10px; border-radius:5px; margin-top:10px; font-size:16px; word-break: break-all; }
    .timer { font-size:14px; color:#ff0000; margin-top:5px; }
    .email-desc { margin:15px 0; font-size:14px; color:#444; }
    .btn-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:12px 0; }
    .btn { padding:8px 0; background:#00C497; color:#fff; font-size:14px; border:none; border-radius:4px; cursor:pointer; width:100%; }
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .inbox-wrapper { display: flex; margin: 20px; gap: 10px; }
    .ad-side { flex: 1; background: #eef1f5; border: 2px dashed #aaa; border-radius: 5px; text-align: center; line-height: 400px; color: #666; min-width: 100px; }
    .inbox-section { flex: 3; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 4px rgba(0,0,0,0.05); height: 400px; overflow-y: auto; position: relative; }
    .inbox-item { display:flex; justify-content:space-between; gap:10px; padding:12px; margin:6px 0; border:1px solid #ddd; border-radius:6px; background:#fafafa; align-items:flex-start; }
    .inbox-item.empty { justify-content:center; color:#666; }
    .inbox-item button { background:#00C497; border:none; color:#fff; padding:6px 12px; font-size:13px; border-radius:4px; cursor:pointer; white-space:nowrap; }
    .loader-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; flex-direction: column; align-items: center; justify-content: center; }
    .loader-circle { width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #00C497; border-radius: 50%; animation: spin 1s linear infinite; position: relative; }
    .loader-icon .envelope-icon { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; color: #00C497; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .ad-placeholder { background:#eef1f5; height:60px; margin:20px; border:2px dashed #aaa; border-radius:5px; text-align:center; line-height:60px; color:#666; }
    footer { padding:20px; text-align:center; background:#fff; font-size:12px; color:#999; border-top:1px solid #ddd; }
    .footer-links { margin-top:10px; }
    .footer-links a { margin: 0 10px; color: #00C497; text-decoration: none; font-weight: 500; }
    .articles-section h3 { cursor: pointer; color: #00C497; margin-top: 20px; }
    .article-content { display: none; padding-left: 15px; }
    .info-section{ margin:20px; padding:16px; background:#fff; border-radius:10px; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
    .meta-mini{font-size:12px; color:#666; margin-top:8px}
    .tag{display:inline-block; font-size:12px; background:#eef1f5; border:1px solid #ddd; padding:4px 8px; border-radius:999px; margin:0 6px}
    .otp{color:#0b7; font-weight:700}
    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.35);
      display:none; align-items:center; justify-content:center; padding:16px;
      z-index:9999;
    }
    .modal{
      width:min(900px, 96vw);
      max-height:85vh;
      overflow:auto;
      background:#fff;
      border-radius:12px;
      box-shadow:0 12px 40px rgba(0,0,0,.25);
      border:1px solid rgba(0,0,0,.08);
    }
    .modal-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px; border-bottom:1px solid #eee;
      position:sticky; top:0; background:#fff;
    }
    .modal-head h4{margin:0; font-size:14px}
    .modal-close{
      background:#00C497; color:#fff; border:0; border-radius:8px;
      padding:8px 10px; cursor:pointer;
    }
    .modal-body{padding:14px}
    pre{white-space:pre-wrap; word-break:break-word; margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:#222;}
    .warn{color:#b00; font-weight:600}
  </style>
</head>

<body>
  <header><h1>Temp Mail</h1></header>

  <div class="email-box">
    <div>Your Temporary Email Address</div>
    <div class="email-address" id="email-address">‚Äî</div>
    <div class="timer" id="timer">10:00</div>
    <p class="email-desc">
      Keep spam and hacking away! Temp Mail gives you a secure, anonymous, and disposable email address that protects your real inbox.
    </p>

    <div class="btn-grid">
      <button class="btn" id="btnCopy" onclick="copyEmail()">Copy</button>
      <button class="btn" id="btnRefresh" onclick="refreshEmail()">Refresh</button>
      <button class="btn" id="btnChange" onclick="changeEmail()">Change</button>
      <button class="btn" id="btnDelete" onclick="deleteEmail()">Delete</button>
    </div>

    <div class="meta-mini">
      <span class="tag" id="domainTag">domain: ‚Äî</span>
      <span class="tag" id="statusTag">status: ready</span>
      <span class="tag" id="otpTag" style="display:none;">OTP: <span class="otp" id="otpValue"></span></span>
    </div>
  </div>

  <div class="ad-placeholder">Ad Area 1</div>

  <div class="inbox-wrapper">
    <div class="ad-side">Ad Left</div>

    <div class="inbox-section">
      <h3>Inbox</h3>

      <div class="loader-icon" id="loader">
        <div class="loader-circle"></div>
        <div class="envelope-icon">&#9993;</div>
        <span>Checking mail...</span>
      </div>

      <div id="inboxList">
        <div class="inbox-item empty">Your inbox is empty<br>Waiting for incoming emails</div>
      </div>
    </div>

    <div class="ad-side">Ad Right</div>
  </div>

  <div class="ad-placeholder">Ad Area 2</div>

  <div class="info-section">
    <h2>What is Disposable Temporary E-mail?</h2>
    <p>Disposable email ‚Äì a free email address that self-destructs after a certain time, keeping your real inbox clean and spam-free.</p>
  </div>

  <div class="articles-section">
    <h2>Popular Articles</h2>
    <ul>
      <li>
        <h3 onclick="toggleArticle(this)">New Temp Mail Android App (2025)</h3>
        <div class="article-content">
          <p>Are you tired of spam emails flooding your inbox every time you sign up on a new website or app?</p>
          <p>In 2025, protecting your digital identity is more important than ever. That‚Äôs why the new Temp Mail Android App is a must-have tool for anyone who values privacy, security, and simplicity.</p>
          <p>Whether you're a developer, tester, or just someone who wants a clean inbox, this app makes it effortless to generate and manage temporary email addresses on the go.</p>
          <p><strong>üöÄ What is the Temp Mail Android App?</strong></p>
          <ul>
            <li>Create a random temp email</li>
            <li>Receive messages and OTPs</li>
            <li>Copy, refresh, or delete the address</li>
            <li>Avoid spam and stay anonymous</li>
          </ul>
          <p><strong>üÜï What‚Äôs New in the 2025 Version?</strong></p>
          <ul>
            <li>‚úÖ One-Click Email Generation</li>
            <li>‚úÖ Real-Time Push Notifications</li>
            <li>‚úÖ Multiple Inbox Support</li>
            <li>‚úÖ Dark Mode Interface</li>
            <li>‚úÖ QR Code Scan & Share</li>
            <li>‚úÖ Secure Message Storage</li>
            <li>‚úÖ Smart Filters</li>
          </ul>
        </div>
      </li>

      <li>
        <h3 onclick="toggleArticle(this)">How to Receive SMS OTP Online (2025)</h3>
        <div class="article-content">
          <p>In today‚Äôs fast-paced digital world, almost every website or app requires a One-Time Password (OTP) to verify your identity. But what if you don‚Äôt want to use your personal mobile number?</p>
          <ul>
            <li>Sign up on a new website without spam</li>
            <li>Bypass phone verification during testing</li>
            <li>Register for a service without exposing your real number</li>
            <li>Access multiple accounts on the same platform</li>
          </ul>
          <p>This is where receiving SMS OTP online becomes incredibly useful.</p>
          <p><strong>üßæ What is an Online SMS Receive Service?</strong></p>
          <ul>
            <li>Receive SMS OTPs</li>
            <li>Bypass mobile number verification</li>
            <li>Use for temporary registrations</li>
          </ul>

          <p><strong>üîê Why Use Online SMS Services in 2025?</strong></p>
          <ul>
            <li>‚úÖ Privacy</li>
            <li>‚úÖ Spam Protection</li>
            <li>‚úÖ Multiple Accounts</li>
            <li>‚úÖ Free or Low Cost</li>
          </ul>
        </div>
      </li>

      <li>
        <h3 onclick="toggleArticle(this)">Best Anonymous Registration Games (2025)</h3>
        <div class="article-content">
          <p>Anonymous registration games are perfect for privacy-focused gamers.</p>
          <ul>
            <li>‚úÖ No personal email required</li>
            <li>‚úÖ No real-name policy</li>
            <li>‚úÖ Quick guest access</li>
            <li>‚úÖ Great for testing or casual play</li>
          </ul>
          <p>Top anonymous-friendly games include:</p>
          <ul>
            <li>‚Ä¢ Krunker.io</li>
            <li>‚Ä¢ Agar.io</li>
            <li>‚Ä¢ Shell Shockers</li>
            <li>‚Ä¢ War Brokers</li>
            <li>‚Ä¢ Paper.io</li>
          </ul>
        </div>
      </li>

      <li>
        <h3 onclick="toggleArticle(this)">What is Ransomware?</h3>
        <div class="article-content">
          <p>Ransomware is a type of malicious software (malware) that locks or encrypts your files and demands payment (ransom) to unlock them.</p>
          <p><strong>üõ°Ô∏è How Does It Work?</strong></p>
          <p>Ransomware usually spreads through phishing emails, malicious downloads, or software vulnerabilities.</p>
          <p><strong>üîê How to Protect Yourself?</strong></p>
          <ul>
            <li>‚úÖ Never click unknown email links or attachments</li>
            <li>‚úÖ Use antivirus & firewall protection</li>
            <li>‚úÖ Keep backups of your files</li>
            <li>‚úÖ Update all software regularly</li>
          </ul>
        </div>
      </li>

      <li>
        <h3 onclick="toggleArticle(this)">Temp Mail for Facebook, etc.</h3>
        <div class="article-content">
          <p>Temp Mail lets you register quickly and anonymously. It‚Äôs perfect for:</p>
          <ul>
            <li>‚úÖ Creating multiple social accounts</li>
            <li>‚úÖ Avoiding spam and tracking</li>
            <li>‚úÖ Testing account setups</li>
          </ul>
          <p>‚ö†Ô∏è Note: Some services may block temp emails, so try different domains or use premium temp mail services when needed.</p>
        </div>
      </li>
    </ul>
  </div>

  <div class="ad-placeholder">Ad Area 3</div>

  <footer>
    TEMP MAIL | Disposable Email Service | ¬© 2025
    <div class="footer-links">
      <a href="#" onclick="toggleSection('privacy')">Privacy</a>
      <a href="#" onclick="toggleSection('terms')">Terms</a>
      <a href="#" onclick="toggleSection('faq')">FAQ</a>
      <a href="#" onclick="toggleSection('contact')">Contact</a>
    </div>

    <div id="privacy" style="display:none; margin-top:10px; text-align:left; font-size:13px; color:#444;">
      <strong>Privacy Policy:</strong><br><br>
      We do not store your personal data. All temporary emails are automatically deleted after a short period. No tracking, no logging. We may use cookies only for session management and UI improvement.<br><br>
      Temp Mail does not associate generated emails with users' IP addresses or other identifiable details. Our servers log minimal and anonymous usage statistics solely for monitoring service performance and detecting abuse (such as bots or mass scraping). We do not use third-party analytics or share any user data with advertisers.<br><br>
      Since this is a public-facing temporary service, we highly recommend not using Temp Mail for receiving sensitive information such as banking credentials, passwords, or identity documents.<br><br>
      For privacy concerns, contact: <strong>jhonhamare@gmail.com</strong>
    </div>

    <div id="terms" style="display:none; margin-top:10px; text-align:left; font-size:13px; color:#444;">
      <strong>Terms of Use:</strong><br><br>
      Use this service at your own risk. Do not use for illegal or sensitive activities. We are not responsible for any misuse or data loss. Temporary emails are deleted frequently.<br><br>
      For legal queries: <strong>jhonhamare@gmail.com</strong>
    </div>

    <div id="faq" style="display:none; margin-top:10px; text-align:left; font-size:13px; color:#444;">
      <strong>FAQ:</strong><br><br>
      <strong>Q: Is Temp Mail free?</strong><br>
      A: Yes, completely free.<br><br>
      <strong>Q: How long does an email stay active?</strong><br>
      A: Usually 10 to 60 minutes.<br><br>
      <strong>Q: Can I use this for account recovery or banking?</strong><br>
      A: No. It is meant for temporary registrations only.<br><br>
      Still confused? Email us at: <strong>jhonhamare@gmail.com</strong>
    </div>

    <div id="contact" style="display:none; margin-top:10px; text-align:left; font-size:13px; color:#444;">
      <strong>Contact Us:</strong><br><br>
      If you have any questions, feedback, or complaints, feel free to email:<br>
      <strong>jhonhamare@gmail.com</strong>
    </div>
  </footer>

  <!-- Message Modal -->
  <div class="modal-backdrop" id="modalBackdrop" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-head">
        <h4 id="modalTitle">Message</h4>
        <button class="modal-close" onclick="closeModal()">Close</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    /***********************
     * REAL mail.tm LOGIC  *
     ***********************/
    const API = "https://api.mail.tm";

    // UI helpers
    const loader = document.getElementById("loader");
    const inboxList = document.getElementById("inboxList");
    const emailEl = document.getElementById("email-address");
    const domainTag = document.getElementById("domainTag");
    const statusTag = document.getElementById("statusTag");
    const otpTag = document.getElementById("otpTag");
    const otpValue = document.getElementById("otpValue");

    const btnCopy = document.getElementById("btnCopy");
    const btnRefresh = document.getElementById("btnRefresh");
    const btnChange = document.getElementById("btnChange");
    const btnDelete = document.getElementById("btnDelete");

    // Timer (10 min)
    let timerInterval = null;
    let timeLeft = 600;

    // Auto refresh inbox
    let inboxPoll = null;

    // Local storage keys
    const LS_ADDR = "tm_address";
    const LS_PASS = "tm_password";
    const LS_TOKEN = "tm_token";
    const LS_DOMAIN = "tm_domain";

    function setStatus(text) {
      statusTag.textContent = "status: " + text;
    }

    function showLoader(show) {
      loader.style.display = show ? "flex" : "none";
    }

    function setOTP(val) {
      if (val) {
        otpValue.textContent = val;
        otpTag.style.display = "inline-block";
      } else {
        otpValue.textContent = "";
        otpTag.style.display = "none";
      }
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").innerText =
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      timeLeft = 600;
      updateTimerDisplay();
      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          // Auto rotate mailbox after 10 minutes
          changeEmail();
        }
      }, 1000);
    }

    function disableButtons(disabled) {
      btnCopy.disabled = disabled;
      btnRefresh.disabled = disabled;
      btnChange.disabled = disabled;
      btnDelete.disabled = disabled;
    }

    function saveSession(address, password, token, domain) {
      localStorage.setItem(LS_ADDR, address || "");
      localStorage.setItem(LS_PASS, password || "");
      localStorage.setItem(LS_TOKEN, token || "");
      localStorage.setItem(LS_DOMAIN, domain || "");
    }

    function loadSession() {
      const address = localStorage.getItem(LS_ADDR) || "";
      const password = localStorage.getItem(LS_PASS) || "";
      const token = localStorage.getItem(LS_TOKEN) || "";
      const domain = localStorage.getItem(LS_DOMAIN) || "";
      if (address && password && token) return { address, password, token, domain };
      return null;
    }

    function clearSession() {
      localStorage.removeItem(LS_ADDR);
      localStorage.removeItem(LS_PASS);
      localStorage.removeItem(LS_TOKEN);
      localStorage.removeItem(LS_DOMAIN);
    }

    async function apiGET(path, token) {
      const res = await fetch(API + path, {
        headers: token ? { "Authorization": `Bearer ${token}` } : {}
      });
      if (!res.ok) {
        const txt = await res.text();
        throw new Error(txt || ("GET " + path + " failed"));
      }
      return await res.json();
    }

    async function apiPOST(path, body) {
      const res = await fetch(API + path, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      if (!res.ok) {
        const txt = await res.text();
        throw new Error(txt || ("POST " + path + " failed"));
      }
      return await res.json();
    }

    function rand(n=8) {
      const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
      let s = "";
      for (let i=0;i<n;i++) s += chars[Math.floor(Math.random()*chars.length)];
      return s;
    }

    function strongPass() {
      return rand(10) + "#@" + rand(4);
    }

    async function getAvailableDomain() {
      const data = await apiGET("/domains");
      const list = (data["hydra:member"] || []).map(d => d.domain).filter(Boolean);
      if (!list.length) throw new Error("No domains available from mail.tm");
      return list[Math.floor(Math.random() * list.length)];
    }

    async function createMailbox() {
      setStatus("creating mailbox...");
      showLoader(true);

      const domain = await getAvailableDomain();
      const user = "user" + rand(6);
      const address = `${user}@${domain}`;
      const password = strongPass();

      // Create account (can fail if collision, then retry once)
      try {
        await apiPOST("/accounts", { address, password });
      } catch (e) {
        // Retry once with new address
        const user2 = "user" + rand(7);
        const address2 = `${user2}@${domain}`;
        await apiPOST("/accounts", { address: address2, password });
        return { address: address2, password, domain };
      }

      return { address, password, domain };
    }

    async function loginToken(address, password) {
      const data = await apiPOST("/token", { address, password });
      if (!data.token) throw new Error("Token not received");
      return data.token;
    }

    async function refreshInboxReal() {
      const session = loadSession();
      if (!session) {
        inboxList.innerHTML = `<div class="inbox-item empty">No mailbox yet. Click Change to generate one.</div>`;
        return;
      }

      setOTP(null);
      setStatus("checking inbox...");
      showLoader(true);

      try {
        const data = await apiGET("/messages", session.token);
        const msgs = data["hydra:member"] || [];

        if (!msgs.length) {
          inboxList.innerHTML = `<div class="inbox-item empty">Your inbox is empty<br>Waiting for incoming emails</div>`;
          setStatus("inbox empty");
          return;
        }

        // Render messages
        inboxList.innerHTML = msgs.map(m => {
          const from = (m.from && m.from.address) ? m.from.address : "unknown";
          const subj = m.subject || "(no subject)";
          const intro = m.intro || "";
          const created = m.createdAt ? new Date(m.createdAt).toLocaleString() : "";
          return `
            <div class="inbox-item">
              <div style="flex:1; min-width:0;">
                <div style="font-weight:700; margin-bottom:4px;">${escapeHtml(subj)}</div>
                <div style="font-size:12px; color:#666;">From: ${escapeHtml(from)} ‚Ä¢ ${escapeHtml(created)}</div>
                <div style="font-size:12px; color:#444; margin-top:6px;">${escapeHtml(intro)}</div>
              </div>
              <button onclick="openMessage('${m.id}')">Open</button>
            </div>
          `;
        }).join("");

        setStatus(`messages: ${msgs.length}`);
      } catch (e) {
        console.error(e);
        setStatus("token expired / error");
        inboxList.innerHTML = `
          <div class="inbox-item empty">
            <div>
              <div class="warn">Inbox error.</div>
              <div style="font-size:12px; margin-top:6px;">
                Try Change (new email) or Refresh again.
              </div>
            </div>
          </div>
        `;
      } finally {
        showLoader(false);
      }
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    async function openMessage(id) {
      const session = loadSession();
      if (!session) return;

      setStatus("opening message...");
      showLoader(true);

      try {
        const full = await apiGET(`/messages/${id}`, session.token);
        const subj = full.subject || "(no subject)";
        const from = (full.from && full.from.address) ? full.from.address : "unknown";
        const intro = full.intro || "";
        const text = full.text || "";
        let html = "";
        if (Array.isArray(full.html)) html = full.html.join("\n");
        else if (typeof full.html === "string") html = full.html;

        // OTP detect
        const otp = extractOTP(text) || extractOTP(intro);
        setOTP(otp);

        // Show in modal
        document.getElementById("modalTitle").textContent = subj;
        document.getElementById("modalBody").innerHTML = `
          <div style="font-size:12px; color:#666; margin-bottom:10px;">
            <div><b>From:</b> ${escapeHtml(from)}</div>
            ${otp ? `<div><b>OTP:</b> <span class="otp">${escapeHtml(otp)}</span></div>` : ""}
          </div>
          <div style="font-size:12px; color:#666; margin-bottom:6px;"><b>Text Body</b></div>
          <pre>${escapeHtml(text || "(No text body)")}</pre>
          ${html ? `
            <hr class="hr">
            <div style="font-size:12px; color:#666; margin-bottom:6px;"><b>HTML (raw preview)</b></div>
            <pre>${escapeHtml(html.slice(0, 6000))}</pre>
          ` : ""}
        `;
        document.getElementById("modalBackdrop").style.display = "flex";

        setStatus("message opened");
      } catch (e) {
        console.error(e);
        alert("Open failed: " + String(e));
        setStatus("open failed");
      } finally {
        showLoader(false);
      }
    }

    function extractOTP(s) {
      if (!s) return null;
      const m = String(s).match(/\b(\d{4,8})\b/);
      return m ? m[1] : null;
    }

    function closeModal(ev) {
      if (!ev || ev.target.id === "modalBackdrop") {
        document.getElementById("modalBackdrop").style.display = "none";
      }
    }

    /***********************
     * BUTTON FUNCTIONS    *
     ***********************/
    async function copyEmail() {
      const email = emailEl.innerText.trim();
      if (!email || email === "‚Äî" || email === "Deleted...") return alert("No email to copy");

      try {
        await navigator.clipboard.writeText(email);
        alert("Copied: " + email);
      } catch {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = email;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        alert("Copied: " + email);
      }
    }

    async function refreshEmail() {
      await refreshInboxReal();
    }

    async function changeEmail() {
      disableButtons(true);
      setOTP(null);
      inboxList.innerHTML = `<div class="inbox-item empty">Generating new mailbox‚Ä¶</div>`;

      try {
        showLoader(true);
        setStatus("generating new email...");
        const { address, password, domain } = await createMailbox();
        const token = await loginToken(address, password);

        // Save & render
        saveSession(address, password, token, domain);

        emailEl.innerText = address;
        domainTag.textContent = "domain: " + domain;
        setStatus("ready");
        startTimer();

        // Refresh inbox now
        await refreshInboxReal();

        // Start polling (every 10s)
        if (inboxPoll) clearInterval(inboxPoll);
        inboxPoll = setInterval(() => refreshInboxReal(), 10000);

      } catch (e) {
        console.error(e);
        setStatus("failed");
        inboxList.innerHTML = `<div class="inbox-item empty"><span class="warn">Failed to create mailbox.</span><br>${escapeHtml(String(e))}</div>`;
      } finally {
        showLoader(false);
        disableButtons(false);
      }
    }

    async function deleteEmail() {
      disableButtons(true);
      setOTP(null);
      setStatus("deleted");
      emailEl.innerText = "Deleted...";
      domainTag.textContent = "domain: ‚Äî";
      inboxList.innerHTML = `<div class="inbox-item empty">Mailbox cleared.</div>`;
      clearSession();
      if (inboxPoll) clearInterval(inboxPoll);
      if (timerInterval) clearInterval(timerInterval);

      setTimeout(async () => {
        disableButtons(false);
        await changeEmail();
      }, 1200);
    }

    /***********************
     * UI TOGGLES          *
     ***********************/
    function toggleArticle(header) {
      const content = header.nextElementSibling;
      content.style.display = content.style.display === 'block' ? 'none' : 'block';
    }

    function toggleSection(id) {
      const section = document.getElementById(id);
      const sectionContainer = document.querySelector('.info-section');
      const allSections = ['privacy', 'terms', 'faq', 'contact'];

      allSections.forEach(secId => {
        const sec = document.getElementById(secId);
        if (sec && sec !== section) sec.style.display = 'none';
      });

      if (section.style.display === 'block') {
        section.style.display = 'none';
      } else {
        section.style.display = 'block';
        sectionContainer.parentNode.insertBefore(section, sectionContainer);
        section.scrollIntoView({ behavior: 'smooth' });
      }
    }

    /***********************
     * STARTUP             *
     ***********************/
    window.onload = async () => {
      disableButtons(false);
      setOTP(null);

      // If session exists, reuse it
      const session = loadSession();
      if (session) {
        emailEl.innerText = session.address;
        domainTag.textContent = "domain: " + (session.domain || session.address.split("@")[1] || "‚Äî");
        setStatus("ready");
        startTimer();
        await refreshInboxReal();

        if (inboxPoll) clearInterval(inboxPoll);
        inboxPoll = setInterval(() => refreshInboxReal(), 10000);
      } else {
        // auto-generate first mailbox
        await changeEmail();
      }
    };
  </script>
</body>
</html>
